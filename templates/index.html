<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-compatible" content="ie/edge>
    <link href="https://assets.shopfront.envato-static.com/styles-4ffeb2c80912c7938da3.css" media="all" rel="stylesheet"
          type="text/css">
    <style>
        body {
            font-family: arial, sans-serif;
            font-size: small;
            margin: 20px;
        }

        td {
            padding: 5px;
            font-size: small;
        }

        .bullish {
            background: green;
            color: white;
        }

        .bearish {
            background: red;
            color: white;
        }

        .consolidating {
            background: green;
            color: white;
        }

        .breakout {
            background: green;
            color: white;
        }
    </style>
    <title>Financial Scanner</title>
</head>
<body>
<h1>Technical Scanner</h1>
<form action="#" method="GET">
    <input type="button" onclick="window.location.href='/snapshot';" value="Refresh Data"/>
{#    <button onClick="window.location.reload();">Refresh Page</button>#}
    <br>
</form>
<form action="#" method="POST">
    <table>
        <tr>
            <td>
                <label><input type='checkbox' name='filter' value='consolidating'> Consolidating</label>
            </td>
            <td>
                <label>Consolidating range (percentage)<input type='text' name='consolidating_pct' value="2">%</label>
            </td>
        </tr>
        <tr>
            <td>
                <label><input type='checkbox' name='filter' value='breakout'> Breakout</label>
            </td>
            <td>
                <label>Breakout percentage <input type='text' name='breakout_pct' value="2.5">%</label>
            </td>
        </tr>
        <tr>
            <td>
                <label><input type='checkbox' name='filter' value='ttm_squeeze'> TTM Squeeze</label>
            </td>
        </tr>
        <tr>
            <td>
                <label><input type='checkbox' name='filter' value='candlestick' checked> Candlestick</label>
            </td>
        </tr>
        <tr>
            <td>
                <label><input type='checkbox' name='filter' value='sma_filter'> SMA Fast above Slow</label>
            </td>
            <td>
                <label>SMA Fast <input type='text' name='sma_fast' value="50"> days</label><br>
                <label>SMA Slow <input type='text' name='sma_slow' value="100"> days</label>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <label><input type='checkbox' name='filter' value='investor_reco'> Investor Reco (finviz.com). Takes a long time</label>
            </td>
        </tr>
    </table>
    <input type="submit" value="Refresh Filters">
{#    onclick="window.location.href='/filter';" />#}
    {#    <input type="submit" onclick="window.location.href='/filter';" value="Refresh Filters"/>#}
</form>
{#<form>#}
{#    <label>#}
{#        <select name="pattern">#}
{#            <option value="">-- Select a Pattern --</option>#}
{#            {% for key in candlestick_patterns %}#}
{#                <option value="{{ key }}"#}
{#                        {% if pattern == key %}selected="selected"{% endif %}>{{ candlestick_patterns[key] }}</option>#}
{#            {% endfor %}#}
{#        </select>#}
{#    </label>#}
{#    <input type="submit" value="Scan"/>#}
{#</form>#}

<table>
    <tr>
        <th>Symbol</th>
        <th>Company</th>
        <th>Bull Candle Signal</th>
        <th>Bear Candle Signal</th>
        <th>Investor's Reco</th>
    </tr>
    {% for symbol in stocks %}
    <tr>
        <td>
            <a href="https://www.finviz.com/quote.ashx?t={{ symbol }}"
               onmouseover="document.getElementById('place-holder-1').src='https://finviz.com/chart.ashx?t={{ symbol }}&ty=c&ta=1&p=d&s=l';"
               onmouseout="document.getElementById('place-holder-1').src='https://linkpeek.com/theme/img/linkpeek-transparent-pixel-placeholder.png';">
                {{ symbol }}
                <img src="https://linkpeek.com/theme/img/linkpeek-transparent-pixel-placeholder.png"
                     id="place-holder-1" style="zindex: 100; position: relative;"  alt=""/>
            </a>
        </td>
        <td>
            {{ stocks[symbol]['Security'] }}
        </td>
        {% autoescape false %}
        <td class="bullish">
            {{ stocks[symbol]['cdl_sum_bul']  | replace(", ", "<br/>") }}
        </td>
        <td class="bearish">
            {{ stocks[symbol]['cdl_sum_ber']  | replace(", ", "<br/>") }}
        </td>
        <td class="investor_sum">
            {{ stocks[symbol]['investor_sum'] }}
        </td>
        {% endautoescape %}

        {#            <tr>#}
        {#                <td colspan="3">#}
        {#                    <img src="https://finviz.com/chart.ashx?t={{ symbol }}&ty=c&ta=1&p=d&s=l" width="75%"/>#}
        {#                </td>#}
        {#            </tr>#}
        <!-- <tr>
            <td colspan="3">
                <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
                <div class="chart" id="candlestick{{ symbol }}">
                    <script>
                        var graphs = {{ stocks[symbol]['chart'] | safe }};
                        Plotly.plot('candlestick{{ symbol }}', graphs, {});
                    </script>
                </div>
            </td>
        </tr> -->
        {% endfor %}
</table>

{#{% for table in tables %}#}
{#            {{titles[loop.index]}}#}
{#            {{ table|safe }}#}
{#{% endfor %}#}

</body>
</html>
